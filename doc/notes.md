# Notes on Coroutines in Pharo## Methods used for micro performance measurementsThe way performance measurements is performed is using `Time class>>#microsecondsToRun:`:```methodmicrosecondsToRun: timedBlock        | initialMicroseconds |       initialMicroseconds := self microsecondClockValue.       timedBlock value.       ^self microsecondClockValue - initialMicroseconds```Often the time it takes to execute a small block will be sub-microsecond, it is necessary to repeat the target block a number of times.```methodmicrosecondsFor: block repeat: n	^ Time microsecondsToRun: [ n timesRepeat: block ]```### Repeating the measurementsThere are many aspects of the host computer which might affect the timing of the performance measurement:- Garbage collection- Non pharo tasks (music, internet connections, background processes).It is common practice to repeat the measurements a number of times. This results in a series of measurements, some grosely affected of background noice, others less so. To get the best estimate of what the actual performance is we use the **minimum** from the measurements series (the one which had less noice).### Performance measure toolA simple tools automates the above:```timer := AAA_ExperimentTimer new blockReps: 100000; measureReps: 10000.timer minFor: [ "block to be measured" ]```With the following implementation of `minFor:`:```methodminFor: block 	^ (1 to: measureReps) 		inject: Float fmax 		into: [ :min :dummy | 			min min: (Time microsecondsToRun: [ blockReps timesRepeat: block ]) ]```## Performance of ContextThese measurements are done using the methodologies above. Performance measures are done on Pharo11.0.0build: 175, commit: d5c6f3f on a MacBook Pro (15-inch, 2018) running macos 12.5.1.Baseline performance for method with empty body (just returning self)```a := AAA_ContextPerformanceTests new.timer := AAA_ExperimentTimer new blockReps: 100000; measureReps: 10000.timer minFor: [ a baselineMethodCall ].  "596"```returning `thisContext` rather than `self`:```methodwithThisContext	^thisContext```Yielding this measurement:```timer minFor: [ a withThisContext ]. "2096"```### thisContext 3.5 times slower## Case: Generator